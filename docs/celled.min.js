!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).CellEd={})}(this,(function(t){"use strict";var e=function(){function t(){this.handlers={}}return t.prototype.addHandler=function(t,e){var n=this.handlers;n[t]=n[t]||[],n[t].push(e)},t.prototype.removeHandler=function(t,e){var n=this.handlers[t];n&&e&&n.splice(n.indexOf(e),1)},t.prototype.emit=function(t,e){var n=this.handlers[t];n&&n.forEach((function(t){try{t(e)}catch(t){}}))},t}();var n="ced-row",i="ced-cell",o="ced-readonly";function r(t){return"."+t}var l=function(){function t(t,n){this.rows=[],this.cells=[],this.events=new e,this.container="string"==typeof t?a(t):t,n&&this.init(n)}return t.prototype.init=function(t){var e=this;this.options=t;var o=this.container,l=this.rows;o.innerHTML="",l.length=0,t.input?(this.cellInput="function"==typeof t.input?t.input():t.input,h(this.cellInput)):this.cellInput=u('<input id="celled-cell-input" type="text" >'),this.hiddenInput=u('<div id="celled-hidden-input" style="position:absolute; z-index:-1; left:2px; top: 2px;" contenteditable tabindex="0"></div>');var s=u('<div class="ced-grid-container"></div>'),c=this.grid=u('<div class="ced-grid"><div class="'+n+' ced-head"></div></div>');o.appendChild(s),s.appendChild(this.hiddenInput),s.appendChild(c);var d=a(o,r("ced-head"));t.cols.forEach((function(t,n){return d.appendChild(e.createHeadCell(t,n))})),function(t,e){e||(e=t,t=document);return[].slice.call(t.querySelectorAll(e))}(d,r(i)).forEach((function(t){return t.style.width=t.offsetWidth+"px"})),this.createRows(),this.initMouse(),this.initKeys(),this.initClipboard()},t.prototype.on=function(t,e){this.events.addHandler(t,e)},t.prototype.update=function(t,e,n){this.setCell(this.rows[t].cells[e],n)},t.prototype.addRows=function(t){var e=this;this.options.canAddRows&&([].push.apply(this.options.rows,t),t.forEach((function(t){e.createRow(t).cells.forEach((function(t){return e.emitInput(t)}))})),this.flattenCells())},t.prototype.addRow=function(){this.addRows([this.options.cols.map((function(t){return""}))])},t.prototype.createHeadCell=function(t,e){var n=this,o=u('<div class="'+i+'" data-ci="'+e+'"><span>'+t+"</span></div>"),r=u('<div class="ced-resizer"></div>');o.appendChild(r);var l=null,s=null,c=null,a=null,h=null,f=function(t){if(h)for(var i=t.target,r=function(){var t=i.getAttribute("data-ci"),o=+t;if(null!==t&&!isNaN(o)){var r=Math.min(e,o),l=Math.max(e,o);return h[0]===r&&h[1]===l||(h=[r,l],n.cells.forEach((function(t){return t.select(t.col>=r&&t.col<=l)})),n.emitSelect()),"break"}i=i.parentElement};i;){if("break"===r())break}else{var u=t.pageX-l;s&&(s.style.width=a-u+"px"),o.style.width=c+u+"px"}},v=function(){l=null,h=null,p(document,"mousemove",f),p(document,"mouseup",v)};return d(o,"mousedown",(function(t){if(t.target===r)s=o.nextElementSibling,l=t.pageX,c=o.offsetWidth,a=s?s.offsetWidth:null;else if(n.rows.length){var e=+o.getAttribute("data-ci");h=!0,n.cells.forEach((function(t){return t.activate(!1).select(t.col===e)})),h=[e,e],n.hiddenInput.focus(),n.activeCell=n.rows[0].cells[e],n.emitSelect()}d(document,"mouseup",v),d(document,"mousemove",f),t.preventDefault()})),o},t.prototype.createRow=function(t){var e=new c(this.rows.length);return e.addCells(t),this.rows.push(e),this.grid.appendChild(e.element),e},t.prototype.createRows=function(){var t=this;this.rows=[],this.options.rows.forEach((function(e){return t.createRow(e)})),this.flattenCells()},t.prototype.flattenCells=function(){this.cells=this.rows.reduce((function(t,e){return t.concat(e.cells)}),[])},t.prototype.initMouse=function(){var t,e,n=this,i=(this.rows,null),o=function(t,e,n,i){return""+t+e+n+i},r=function(t){var e=t.target;if(e&&e.parentElement){var i=e.getAttribute("data-ci"),o=e.parentElement.getAttribute("data-ri"),r=+i,l=+o;return i&&o&&!isNaN(r)&&!isNaN(l)?n.rows[l].cells[r]:void 0}},l=function(l){var s=r(l);if(s){var c=s.row,a=s.col,u=Math.min(c,e),d=Math.max(c,e),p=Math.min(a,t),h=Math.max(a,t),f=o(u,p,d,h);if(i!==f){i=f,n.unselect();for(var v=u;v<=d;++v)for(var m=p;m<=h;++m)n.rows[v].cells[m].select();n.emitSelect()}}},s=function(){p(document,"mousemove",l),p(document,"mouseup",s)},c=Date.now();d(this.grid,"mousedown",(function(a){var u=r(a);if(u){var p=Date.now()-c;if(c=Date.now(),u.input)return;if(u===n.activeCell&&!u.readonly&&p<300)u.startEdit(n.cellInput),n.emitFocus();else{var h=u.row,f=u.col;e=h,t=f,i=o(h,f,h,f),n.activate(u),d(document,"mouseup",s),d(document,"mousemove",l)}a.preventDefault()}})),d(document,"mouseup",(function(t){if(n.activeCell){for(var e=t.target;e;e=e.parentNode)if(e===n.container)return;n.activeCell.activate(!1),n.unselect()&&n.emitSelect()}}))},t.prototype.activate=function(t,e){void 0===e&&(e=!0),this.activeCell&&this.activeCell.activate(!1);var n=!1;this.cells.forEach((function(i){n=i===t?i.selected()!==e:n||i.selected(),i.select(!1)})),this.activeCell=t.select(e).activate(e),n&&this.emitSelect(),this.hiddenInput.focus()},t.prototype.moveActive=function(t,e,n){void 0===n&&(n=!1);var i=this.activeCell;if(i){for(var o=this.rows,r=i.row+t;n&&this.options.canAddRows&&r>=o.length;)this.addRow();var l=o[r];if(l){var s=l.cells[i.col+e];s&&this.activate(s)}}},t.prototype.initKeys=function(){var t=this,e=this.hiddenInput;d(e,"keydown",(function(e){var n=(e=e||window.event).keyCode;46===n&&(t.cells.forEach((function(e){e.selected()&&t.setCell(e,"")})),e.preventDefault()),37===n&&t.moveActive(0,-1),38===n&&t.moveActive(-1,0),39===n&&t.moveActive(0,1),40===n&&t.moveActive(1,0)}));d(this.cellInput,"input",(function(e){var n=t.activeCell;n&&!n.readonly&&n.input&&(t.updatValue(n),t.cells.forEach((function(e){e.selected()&&e!==n&&t.setCell(e,n.value())})))})),d(this.cellInput,"keydown",(function(e){13===e.keyCode&&(t.moveActive(0,0),t.moveActive(1,0,!0),e.preventDefault()),27===e.keyCode&&(t.moveActive(0,0),e.preventDefault())})),d(e,"keypress",(function(e){var n=t.activeCell;!n||n.readonly||n.input?e.preventDefault():(n.startEdit(t.cellInput,!0),t.emitFocus())}))},t.prototype.initClipboard=function(){var t=this;d(this.hiddenInput,"paste",(function(e){e.preventDefault();var n=function(t,e){e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[[]],o=null;o=n.exec(t);){var r=o[1];r.length&&r!==e&&i.push([]);var l=void 0;l=o[2]?o[2].replace(new RegExp('""',"g"),'"'):o[3],i[i.length-1].push(l)}return i}((e.clipboardData||window.clipboardData).getData("text"),"\t"),i=t.activeCell;i&&n.forEach((function(e,n){var o=t.rows[i.row+n];if(!o&&t.options.canAddRows){var r=t.rows[i.row];t.addRows([r.cells.map((function(t){return t.value()}))]),o=t.rows[i.row+n]}var l=i.col,s=1===e.length&&""===e[0];o&&!s&&e.forEach((function(e,n){var i=o.cells[l+n];i&&!i.readonly&&(t.setCell(i,e),i.select())}))}))})),d(this.hiddenInput,"copy",(function(e){e.preventDefault();var n=t.activeCell;if(n){for(var i=[],o=n.row;;o++){var r=t.rows[o],l=[];if(!r||!r.cells[n.col]||!r.cells[n.col].selected())break;for(var s=n.col;;++s){var c=r.cells[s];if(!c||!c.selected())break;l.push(c.value())}i.push(l)}(e.clipboardData||window.clipboardData).setData("text/plain",function(t,e,n){void 0===n&&(n="\n");var i="";return t.forEach((function(t,o){o>0&&(i+=n),t.forEach((function(t,n){(t=t.replace(/"/g,'""')).search(/("|,|\n)/g)>=0&&(t='"'+t+'"'),n>0&&(i+=e),i+=t}))})),i}(i,"\t"))}}))},t.prototype.setCell=function(t,e){t.readonly||(t.set(e),this.updatValue(t))},t.prototype.unselect=function(){var t=!1;return this.cells.forEach((function(e){t=t||e.selected(),e.select(!1)})),t},t.prototype.updatValue=function(t){var e=t.col,n=this.options.rows[t.row],i=n[e];"string"==typeof i||"number"==typeof i?n[e]=t.value():i.value=t.value(),this.emitInput(t)},t.prototype.emitInput=function(t){this.events.emit("input",{grid:this,col:t.col,row:t.row,value:t.value()})},t.prototype.emitFocus=function(){var t=this.activeCell;this.events.emit("focus",{grid:this,col:t.col,row:t.row,value:t.value()})},t.prototype.emitSelect=function(){this.events.emit("select",{grid:this,selection:this.cells.filter((function(t){return t.selected()})).map((function(t){return{row:t.row,col:t.col}}))})},t}(),s=function(){function t(t,e,n){var r;this.row=t,this.col=e,this.readonly=!1,"string"==typeof n||"number"==typeof n?r=n.toString():(this.readonly=n.readonly,r=n.value.toString());var l=i+(this.readonly?" "+o:"");this.element=u('<div data-ci="'+e+'" class="'+l+'">'+r+"</div>")}return t.prototype.selected=function(){return this.element.className.indexOf("ced-selected")>=0},t.prototype.select=function(t){void 0===t&&(t=!0);var e=this.element.classList;return t?e.add("ced-selected"):e.remove("ced-selected"),this},t.prototype.activate=function(t){void 0===t&&(t=!0);var e=this.element.classList;return t?(e.add("ced-active"),e.add("ced-selected")):(e.remove("ced-active"),e.remove("ced-editing"),this.input&&(this.input.blur(),h(this.input),this.element.innerHTML=this.input.value,this.input=null)),this},t.prototype.value=function(){return this.input?this.input.value:this.element.innerHTML},t.prototype.set=function(t){this.readonly||(this.input?this.input.value=t:this.element.innerHTML=t)},t.prototype.startEdit=function(t,e){if(void 0===e&&(e=!1),!this.readonly){var n=this.element;this.input=t,t.value=n.innerHTML,e&&t.select(),t.style.width=n.offsetWidth-2+"px",n.classList.add("ced-editing"),n.innerHTML="",n.appendChild(t),t.focus()}},t}(),c=function(){function t(t){this.index=t,this.cells=[],this.element=u('<div data-ri="'+t+'" class="'+n+'"></div>')}return t.prototype.addCells=function(t){var e=this;t.forEach((function(t,n){var i=new s(e.index,n,t);e.cells.push(i),e.element.appendChild(i.element)}))},t}();function a(t,e){return e||(e=t,t=document),t.querySelector(e)}function u(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}function d(t,e,n){t.addEventListener(e,n)}function p(t,e,n){t.removeEventListener(e,n)}function h(t){t.parentNode&&t.parentElement.removeChild(t)}t.Grid=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=celled.min.js.map
